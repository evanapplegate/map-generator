<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>World GDP per Capita Map</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <script>
        // Load the GeoJSON data
        d3.json("countries.geojson").then(function(geoData) {
            const width = 960, height = 600;

            // Create SVG
            const svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            // Projection and path
            const projection = d3.geoNaturalEarth1().scale(160).translate([width / 2, height / 2]);
            const path = d3.geoPath().projection(projection);

            // Load GDP data
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const gdpData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);

                // Create a map of country names to gdp
                const gdpMap = new Map(gdpData.map(d => [d.NAME, d.gdp_per_capita]));

                // Define color scale
                const gdpValues = Array.from(gdpMap.values()).filter(v => v !== undefined);
                const colorScale = d3.scaleSequential(d3.interpolate("#83ce63", "#005a04"))
                    .domain([Math.min(...gdpValues), Math.max(...gdpValues)]);

                // Draw map
                svg.selectAll("path")
                    .data(geoData.features)
                    .enter().append("path")
                    .attr("d", path)
                    .attr("fill", d => gdpMap.has(d.properties.NAME) ? colorScale(gdpMap.get(d.properties.NAME)) : "#eeeeee")
                    .attr("stroke", "white")
                    .attr("stroke-width", 0.5);

                // No country labels as not requested by the user.
            };
            reader.readAsArrayBuffer(new Blob([new Response("world_gdp.xlsx")]));
        });
    </script>
</body>
</html>