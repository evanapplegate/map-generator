<!-- templates/map.html -->
<!DOCTYPE html>
<html>
<head>
    <title>D3 Map</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
<script>
const width = 960, height = 600;
const firstGroupCountries = ["Nigeria", "Angola", "Algeria"];
const secondGroupCountries = ["England", "France", "Kazakhstan"];
const colorScale = d3.scaleOrdinal().domain(["First group", "Second group"]).range(["blue", "red"]);

const svg = d3.select("body").append("svg").attr("width", width).attr("height", height);
const projection = d3.geoNaturalEarth1().scale(width / 2 / Math.PI).translate([width / 2, height / 2]);
const path = d3.geoPath().projection(projection);

Promise.all([
    d3.json("countries.geojson"),
    d3.json("country_bounds.geojson")
]).then(function([countries, boundaries]) {
    svg.selectAll(".country")
       .data(countries.features)
       .enter().append("path")
       .attr("class", "country")
       .attr("d", path)
       .style("fill", d => firstGroupCountries.includes(d.properties.NAME) ? "blue" : secondGroupCountries.includes(d.properties.NAME) ? "red" : "#eeeeee")
       .style("stroke", "white")
       .style("stroke-width", 0.5);

    svg.selectAll(".label")
       .data(countries.features.filter(d => firstGroupCountries.includes(d.properties.NAME) || secondGroupCountries.includes(d.properties.NAME)))
       .enter().append("text")
       .attr("class", "label")
       .attr("x", d => path.centroid(d)[0])
       .attr("y", d => path.centroid(d)[1])
       .style("font-family", "Arial")
       .style("font-size", "4pt")
       .style("text-anchor", "middle")
       .text(d => d.properties.NAME);

    svg.append("path")
       .datum(boundaries)
       .attr("d", path)
       .style("fill", "none")
       .style("stroke", "white")
       .style("stroke-width", 0.5);

    const legend = svg.append("g")
                      .attr("class", "legend")
                      .attr("transform", "translate(150, 400)");

    legend.selectAll("rect")
          .data(colorScale.domain())
          .enter().append("rect")
          .attr("x", 4)
          .attr("y", (d, i) => i * 8)
          .attr("width", 5)
          .attr("height", 5)
          .style("fill", colorScale);

    legend.selectAll("text")
          .data(colorScale.domain())
          .enter().append("text")
          .attr("x", 10)
          .attr("y", (d, i) => i * 8 + 5)
          .style("font-family", "Arial")
          .style("font-size", "8pt")
          .text(d => d);
});


</script>
</body>
</html>